-- 1. Create the Database (if it doesn't exist)
CREATE DATABASE IF NOT EXISTS portal_booking;
USE portal_booking;

-- 2. Create 'users' table
-- Stores both regular members and admins.
CREATE TABLE users (
    user_id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    email VARCHAR(255) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    role ENUM('admin', 'user') DEFAULT 'user',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 3. Create 'facilities' table
-- Stores information about sports facilities (e.g., Futsal Court, Badminton Court).
CREATE TABLE facilities (
    facility_id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    description TEXT,
    price_per_hour DECIMAL(10, 2) NOT NULL,
    image_path VARCHAR(255),
    is_active TINYINT(1) DEFAULT 1, -- 1 for active, 0 for inactive
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 4. Create 'slots' table
-- Stores specific time slots available for booking for each facility.
CREATE TABLE slots (
    slot_id INT AUTO_INCREMENT PRIMARY KEY,
    facility_id INT NOT NULL,
    start_time DATETIME NOT NULL,
    end_time DATETIME NOT NULL,
    is_available TINYINT(1) DEFAULT 1, -- 1 for available, 0 if blocked/unavailable
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (facility_id) REFERENCES facilities(facility_id) ON DELETE CASCADE
);

-- 5. Create 'bookings' table
-- Stores the main booking transaction information.
CREATE TABLE bookings (
    booking_id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL,
    facility_id INT NOT NULL,
    total_price DECIMAL(10, 2) NOT NULL,
    status ENUM('pending', 'paid', 'approved', 'rejected') DEFAULT 'pending',
    proof_of_payment VARCHAR(255) DEFAULT NULL, -- Path to uploaded payment proof image
    booking_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    payment_date DATETIME DEFAULT NULL,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE,
    FOREIGN KEY (facility_id) REFERENCES facilities(facility_id) ON DELETE CASCADE
);

-- 6. Create 'booking_details' table
-- Links a booking to specific time slots. A single booking can contain multiple slots.
CREATE TABLE booking_details (
    detail_id INT AUTO_INCREMENT PRIMARY KEY,
    booking_id INT NOT NULL,
    slot_id INT NOT NULL,
    price DECIMAL(10, 2) NOT NULL, -- Price of the specific slot at time of booking
    FOREIGN KEY (booking_id) REFERENCES bookings(booking_id) ON DELETE CASCADE,
    FOREIGN KEY (slot_id) REFERENCES slots(slot_id) ON DELETE CASCADE
);

-- ========================================================
-- OPTIONAL: Insert Dummy Data for Testing
-- ========================================================

-- Insert a default Admin user
-- Password is 'password' (hashed using standard BCRYPT algorithm for PHP password_hash)
INSERT INTO users (name, email, password, role) VALUES 
('Super Admin', 'admin@mail.com', 'admin123', 'admin');

-- Insert a default Member user
-- Password is 'password'
INSERT INTO users (name, email, password, role) VALUES 
('John Doe', 'user@mail.com', '123', 'user');

-- Insert some Facilities
INSERT INTO facilities (name, description, price_per_hour, image_path, is_active) VALUES 
('Lapangan Futsal A', 'Rumput Sintetis Standar FIFA', 150000.00, NULL, 1),
('Lapangan Basket Indoor', 'Lantai Kayu, Full AC', 200000.00, NULL, 1),
('Lapangan Badminton 1', 'Karpet Vinyl', 80000.00, NULL, 1);



